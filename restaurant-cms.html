<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant CMS - Complete Content Management System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .menu-item img { width: 120px; height: 120px; object-fit: cover; border-radius: 8px; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }
        .announcement-item { padding: 1rem; margin: 0.5rem 0; background: #f3f4f6; border-radius: 8px; }
        .photo-upload { border: 2px dashed #d1d5db; padding: 2rem; text-align: center; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .photo-upload:hover { border-color: #6366f1; background-color: #f8fafc; }
        .social-links { display: flex; gap: 1rem; margin: 1rem 0; flex-wrap: wrap; }
        .social-link { padding: 0.5rem 1rem; background: #3b82f6; color: white; border-radius: 6px; text-decoration: none; transition: all 0.3s; }
        .social-link:hover { background: #2563eb; transform: translateY(-1px); }
        .category-badge { background: #10b981; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; }
        .ordering-platform { background: #f59e0b; color: white; padding: 0.5rem 1rem; border-radius: 6px; margin: 0.25rem; display: inline-block; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { Upload, Download, Save, Eye, Edit3, Clock, MapPin, Phone, Globe, Star, Plus, Trash2, AlertCircle, Camera, Link, Instagram, Twitter, Utensils, Image, ExternalLink } = lucideReact;

const RestaurantCMS = () => {
  const [activeTab, setActiveTab] = useState('menu');
  const [menuItems, setMenuItems] = useState([]);
  const [menuCategories, setMenuCategories] = useState(['Appetizer', 'Soup', 'Salad', 'Main Dish', 'Biryani', 'Chicken', 'Vegetarian', 'Dessert', 'Beverages']);
  const [isLoading, setIsLoading] = useState(false);
  const [previewMode, setPreviewMode] = useState(false);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState('all');
  const fileInputRef = useRef(null);
  const photoInputRef = useRef(null);

  // Authentication check
  useEffect(() => {
    const password = localStorage.getItem('cms_auth');
    if (password === 'milford2025') {
      setIsAuthenticated(true);
    } else {
      const userPassword = prompt('🔐 Enter Admin Password to Access Restaurant CMS:');
      if (userPassword === 'milford2025') {
        localStorage.setItem('cms_auth', userPassword);
        setIsAuthenticated(true);
      } else {
        alert('❌ Access Denied - Incorrect Password');
        window.location.href = '/';
      }
    }
  }, []);

  // Enhanced restaurant info state
  const [restaurantInfo, setRestaurantInfo] = useState({
    name: 'Milford India Spice',
    tagline: 'Authentic Indian Cuisine',
    phone: '(508) 478-5800',
    address: '123 Main Street, Milford, MA 01757',
    email: 'info@milfordindispice.com',
    website: 'https://milfordindispice.com',
    hours: {
      monday: '11:00 AM - 9:00 PM',
      tuesday: '11:00 AM - 9:00 PM',
      wednesday: '11:00 AM - 9:00 PM',
      thursday: '11:00 AM - 9:00 PM',
      friday: '11:00 AM - 11:00 PM',
      saturday: '11:00 AM - 10:00 PM',
      sunday: '12:00 PM - 9:00 PM'
    },
    socialLinks: {
      facebook: 'https://www.facebook.com/milfordindispice',
      instagram: 'https://www.instagram.com/milfordindispice',
      twitter: 'https://twitter.com/milfordindispice',
      tiktok: 'https://www.tiktok.com/@milfordindispice'
    },
    orderingLinks: {
      ubereats: 'https://www.ubereats.com/milfordindispice',
      doordash: 'https://www.doordash.com/milfordindispice',
      grubhub: 'https://www.grubhub.com/milfordindispice',
      toast: 'https://order.toasttab.com/online/milfordhunangourmet',
      website: 'https://milfordindispice.com/order'
    }
  });

  // Announcements with enhanced features
  const [announcements, setAnnouncements] = useState([
    {
      id: 1,
      title: '🎉 Grand Opening Special',
      content: "We're now open! Enjoy 20% off your first order this week. Welcome to our authentic Indian cuisine experience! 🥘",
      active: true,
      priority: 'high',
      expiryDate: '2024-12-31'
    },
    {
      id: 2,
      title: '🕒 Extended Weekend Hours',
      content: 'Now open Fridays until 11 PM and Saturdays until 10 PM for your weekend cravings!',
      active: true,
      priority: 'medium',
      expiryDate: ''
    },
    {
      id: 3,
      title: '🌟 Catering Services Available',
      content: 'Planning a party or event? We now offer full catering services for private events, corporate gatherings, and celebrations. Call us to create your perfect feast!',
      active: true,
      priority: 'low',
      expiryDate: ''
    }
  ]);

  // Photo management for menu items
  const handlePhotoUpload = (itemId, event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        updateMenuItem(itemId, 'image', e.target.result);
      };
      reader.readAsDataURL(file);
    }
  };

  // Handle Excel file upload with enhanced processing
  const handleFileUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    setIsLoading(true);
    try {
      const arrayBuffer = await file.arrayBuffer();
      const workbook = XLSX.read(arrayBuffer, { type: 'array' });
      const firstSheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet);

      const processedItems = jsonData.map((item, index) => ({
        id: Date.now() + index,
        name: item['Menu Item'] || item['Name'] || '',
        price: parseFloat(item['Price']) || 0,
        description: item['Description'] || item['Descritpion'] || '',
        category: item['Category'] || item['__EMPTY'] || 'Main Dish',
        image: getDefaultImage(item['Category'] || item['__EMPTY'] || 'Main Dish'),
        available: item['Available'] !== 'No',
        isSpicy: item['Spicy'] === 'Yes' || false,
        isVegetarian: item['Vegetarian'] === 'Yes' || false,
        allergens: item['Allergens'] || '',
        preparationTime: item['Prep Time'] || '15-20 mins'
      }));

      setMenuItems(processedItems);
      alert(`Successfully imported ${processedItems.length} menu items!`);
    } catch (error) {
      alert('Error reading file. Please make sure it\'s a valid Excel file.');
      console.error('Error:', error);
    }
    setIsLoading(false);
  };

  // Enhanced default image mapping
  const getDefaultImage = (category) => {
    const imageMap = {
      'Soup': 'https://images.unsplash.com/photo-1547592166-23ac45744acd?w=400&h=400&fit=crop',
      'Salad': 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400&h=400&fit=crop',
      'Appetizer': 'https://images.unsplash.com/photo-1601050690597-df0568f70950?w=400&h=400&fit=crop',
      'Main Dish': 'https://images.unsplash.com/photo-1588166524941-3bf61a9c41db?w=400&h=400&fit=crop',
      'Biryani': 'https://images.unsplash.com/photo-1563379091339-03246963d51a?w=400&h=400&fit=crop',
      'Chicken': 'https://images.unsplash.com/photo-1588166524941-3bf61a9c41db?w=400&h=400&fit=crop',
      'Vegetarian': 'https://images.unsplash.com/photo-1567188040759-fb8a883dc6d8?w=400&h=400&fit=crop',
      'Dessert': 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=400&h=400&fit=crop',
      'Beverages': 'https://images.unsplash.com/photo-1544145945-f90425340c7e?w=400&h=400&fit=crop'
    };
    return imageMap[category] || imageMap['Main Dish'];
  };

  // Enhanced menu item functions
  const addMenuItem = () => {
    const newItem = {
      id: Date.now(),
      name: '',
      price: 0,
      description: '',
      category: 'Main Dish',
      image: getDefaultImage('Main Dish'),
      available: true,
      isSpicy: false,
      isVegetarian: false,
      allergens: '',
      preparationTime: '15-20 mins'
    };
    setMenuItems([...menuItems, newItem]);
  };

  const updateMenuItem = (id, field, value) => {
    setMenuItems(items => 
      items.map(item => 
        item.id === id ? { ...item, [field]: value } : item
      )
    );
  };

  const deleteMenuItem = (id) => {
    if (confirm('Are you sure you want to delete this menu item?')) {
      setMenuItems(items => items.filter(item => item.id !== id));
    }
  };

  // Category management
  const addCategory = () => {
    const newCategory = prompt('Enter new category name:');
    if (newCategory && !menuCategories.includes(newCategory)) {
      setMenuCategories([...menuCategories, newCategory]);
    }
  };

  const deleteCategory = (category) => {
    if (confirm(`Are you sure you want to delete the "${category}" category?`)) {
      setMenuCategories(cats => cats.filter(cat => cat !== category));
      // Update menu items that use this category
      setMenuItems(items => 
        items.map(item => 
          item.category === category ? { ...item, category: 'Main Dish' } : item
        )
      );
    }
  };

  // Enhanced announcement functions
  const addAnnouncement = () => {
    const newAnn = {
      id: Date.now(),
      title: '',
      content: '',
      active: true,
      priority: 'medium',
      expiryDate: ''
    };
    setAnnouncements([...announcements, newAnn]);
  };

  const updateAnnouncement = (id, field, value) => {
    setAnnouncements(anns => 
      anns.map(ann => 
        ann.id === id ? { ...ann, [field]: value } : ann
      )
    );
  };

  const deleteAnnouncement = (id) => {
    if (confirm('Are you sure you want to delete this announcement?')) {
      setAnnouncements(anns => anns.filter(ann => ann.id !== id));
    }
  };

  // Ordering links management
  const addOrderingLink = () => {
    const platform = prompt('Enter platform name (e.g., "postmates", "seamless"):');
    const url = prompt('Enter the ordering URL:');
    if (platform && url) {
      setRestaurantInfo({
        ...restaurantInfo,
        orderingLinks: {
          ...restaurantInfo.orderingLinks,
          [platform.toLowerCase()]: url
        }
      });
    }
  };

  const deleteOrderingLink = (platform) => {
    if (confirm(`Remove ${platform} ordering link?`)) {
      const newLinks = { ...restaurantInfo.orderingLinks };
      delete newLinks[platform];
      setRestaurantInfo({
        ...restaurantInfo,
        orderingLinks: newLinks
      });
    }
  };

  // Export functions
  const exportToExcel = () => {
    const exportData = menuItems.map(item => ({
      'Menu Item': item.name,
      'Price': item.price,
      'Description': item.description,
      'Category': item.category,
      'Available': item.available ? 'Yes' : 'No',
      'Spicy': item.isSpicy ? 'Yes' : 'No',
      'Vegetarian': item.isVegetarian ? 'Yes' : 'No',
      'Allergens': item.allergens,
      'Prep Time': item.preparationTime
    }));

    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Menu');
    XLSX.writeFile(wb, `restaurant_menu_${new Date().toISOString().split('T')[0]}.xlsx`);
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-900 to-red-800 flex items-center justify-center">
        <div className="text-white text-center">
          <div className="text-6xl mb-4">🔐</div>
          <h1 className="text-2xl font-bold">Checking Access...</h1>
          <p>Please wait while we verify your credentials</p>
        </div>
      </div>
    );
  }

  // Filter menu items by category
  const filteredMenuItems = selectedCategory === 'all' 
    ? menuItems 
    : menuItems.filter(item => item.category === selectedCategory);

  return (
    <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50">
      {/* Enhanced Header */}
      <div className="bg-gradient-to-r from-red-800 to-red-900 text-white p-6 shadow-lg">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold mb-2">🍛 Restaurant Content Management System</h1>
            <p className="text-red-100">Complete management for menu, hours, announcements, photos & ordering links</p>
          </div>
          <div className="flex gap-4">
            <button 
              onClick={() => setPreviewMode(!previewMode)}
              className="bg-yellow-600 hover:bg-yellow-500 px-4 py-2 rounded-lg transition-colors flex items-center gap-2"
            >
              <Eye size={16} />
              {previewMode ? 'Edit Mode' : 'Preview'}
            </button>
            <button 
              onClick={() => {
                localStorage.removeItem('cms_auth');
                window.location.reload();
              }}
              className="bg-red-700 hover:bg-red-600 px-4 py-2 rounded-lg transition-colors flex items-center gap-2"
            >
              🚪 Logout
            </button>
          </div>
        </div>
      </div>